---
import type { MarkdownInstance } from "astro";
import Layout from "../../layouts/Layout.astro";
import H1 from "../../components/H1.astro";

export function getStaticPaths() {
  const modules = import.meta.glob("../../contents/articles/*.md", {
    eager: true,
  });
  const articles = Object.values(modules) as MarkdownInstance<
    Record<string, unknown>
  >[];
  return articles.map((article) => ({
    params: { slug: getSlugFromFile(article.file) },
    props: { article },
  }));
}

const { article } = Astro.props as {
  article: MarkdownInstance<Record<string, unknown>>;
};
const title =
  typeof article.frontmatter?.title === "string"
    ? article.frontmatter.title
    : getSlugFromFile(article.file);
const date =
  typeof article.frontmatter?.date === "string"
    ? new Date(article.frontmatter.date).toLocaleDateString("ja-JP", {
        year: "numeric",
        month: "long",
        day: "numeric",
      })
    : null;
const { Content } = article;

export function getSlugFromFile(file: string) {
  const name = file.split(/[\\/]/).pop() ?? file;
  return name.replace(/\.md$/, "");
}
---

<Layout title={`${title}`}>
  <article
    class="text-slate-900 rounded-[20px] border border-[rgba(255,255,255,0.3)] bg-[rgba(255,255,255,0.9)] p-6 shadow-[0_18px_42px_rgba(0,26,77,0.14),inset_0_0_0_0.5px_rgba(12,51,136,0.15)] max-[720px]:p-5"
  >
    <H1>{title}</H1>
    {date && <p class="mt-0 mb-4 font-bold text-[#34558f]">{date}</p>}
    <div class="grid gap-3 leading-[1.7] text-[rgba(11,29,63,0.8)]">
      <Content />
    </div>
  </article>
</Layout>
